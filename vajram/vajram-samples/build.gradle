plugins {
    id 'com.flipkart.krystal' version "${krystal_version}"
    id 'com.google.protobuf' version '0.9.4'
}

sourceSets {
    main {
        proto {
            srcDir 'build/generated/sources/vajramModels/protobuf/main'
        }
    }
}

protobuf {
    protoc {
        artifact = "com.google.protobuf:protoc:${protobuf_version}"
    }
}

tasks.named('extractIncludeProto').configure { mustRunAfter('codeGenVajramModels') }
tasks.named('extractProto').configure { mustRunAfter('codeGenVajramModels') }
tasks.named('generateProto').configure { mustRunAfter('codeGenVajramModels') }

dependencies {
    implementation project(':krystal-common')
    implementation project(':vajram:vajram-java-sdk')
    implementation project(':krystal-visualization')
    implementation project(':lattice:lattice-annotations')
    implementation project(':vajram:extensions:protobuf:vajram-protobuf3')

    annotationProcessor project(':krystal-common')
    annotationProcessor 'com.flipkart.krystal:vajram-protobuf-codegen'
    annotationProcessor 'com.flipkart.krystal:vajram-codegen'

    implementation 'com.google.protobuf:protobuf-java'

    implementation 'jakarta.inject:jakarta.inject-api'
    implementation 'org.checkerframework:checker-qual'

    testImplementation project(':vajram:vajram-krystex')

    testImplementation project(':vajram:extensions:guice:vajram-guice')

    testImplementation 'com.fasterxml.jackson.core:jackson-annotations'
    testImplementation 'com.fasterxml.jackson.core:jackson-databind'
    testImplementation 'com.fasterxml.jackson.datatype:jackson-datatype-jdk8'
    testImplementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310'
}

test {
    minHeapSize = "128m" // initial heap size
    maxHeapSize = "4g" // maximum heap size
}
if (!fast_compile) {
    tasks.named("spotlessJava").configure { dependsOn("codeGenVajramModels") }
}
